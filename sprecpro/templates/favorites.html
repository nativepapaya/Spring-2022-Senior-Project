{% extends 'layouts/app.html' %}

{% block content %}
<div class="row gutters-sm">
    <div class="col-md-4 mb-3">
        <div class="card">
            <div class="card-body">
                <div class="d-flex flex-column align-items-center text-center">
                    <img src="{{ profile.avatar }}" class="rounded-circle"></img>
                    <span>{{ user.first_name }}</span>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="col-md-8">
    <div class="card mb-3">
            <div class="card-body">
                    <div class="row">
                        <h5>Search a SONG to add to FAVORITES</h5>
                        <form type="GET" action="{% url 'search_for_favorites' %}">
                        {% csrf_token %}
                        <div class="mb-2">
                            <input class="form-control" type="text" name="song_name" id="song_box" placeholder="Song Name"></input>
                        </div>
                        <div class="mb-2">
                            <input class="form-control" type="text" name="artist_name" id="album_box" placeholder="Artist Name"></input>
                        </div>
                        
                        <button class="btn btn-primary">Search</button>
                        </form>
                    </div>
            </div>
    </div>
</div>

    <br /><br /><br />

    
    {% if songs %}
        <span>Your searched songs: </span> <br />
        {% for song in songs %}

            <form type="POST" action="{% url 'add_fav' %}">
                <div class="mb-2"> 
                    <iframe src="https://open.spotify.com/embed/track/{{ song.song_id }}" width="300" height="380" 
                    align="left" frameborder="0" allowtransparency="true" allow="encrypted-media"></iframe>

                    <input type="hidden" name="song_id" value="{{ song.song_id }}"></input>
                    <input type="hidden" name="song_name" value="{{ song.song_name }}"></input>
                    <input type="hidden" name="user_id" value="{{ user }}"></input>
                    <input class="btn btn-default btn-outline-dark" type="submit" value="&#10084"/>
                    
                </div>
            </form>
        {% endfor %}
    {% endif %}
                

    <br/><br/>
    <center>
        {% if favorites %}
        <table class="table">
            <thead class="thead-dark">
                <tr>
                    <th scope="col">Song #</th>
                    <th scope="col">Track</th>
                    {% if request.user == user %}
                        <th scope="col">action</th>
                    {% endif %}
                </tr>
            </thead>
            <tbody>
                {% for favorite in favorites %}                
                <tr>
                    <th scope="row">{{ favorite.id }}</th>
                    <td><iframe src="https://open.spotify.com/embed/track/{{ favorite.song_uid }}" width="300" height="80" 
                        frameborder="0" allowtransparency="true" allow="encrypted-media"></iframe></td>
                    {% if request.user == user %}
                        <td>
                            <form method="POST" action="{% url 'delete_fav' favorite.id %}">
                                {% csrf_token %}
                                <input class="btn btn-default btn-danger" type="submit" value="Delete"/>
                            </form>
                        </td>
                    {% endif %}
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% endif %}
    </center>
{% endblock %}